# 赛道分配优化说明

## 修改内容

优化径赛分组的赛道分配逻辑，确保赛道号从1号开始连续分配。

## 修改前的问题

之前的逻辑会随机选择起始赛道号，导致：
- 如果有3个运动员，可能分配到赛道 4, 5, 6
- 如果有2个运动员，可能分配到赛道 3, 4
- 赛道号不固定，每次生成结果不一致

```ruby
# 旧代码
start_lane = rand(1..(max_lanes - lanes_count + 1))
lane_numbers = (start_lane...(start_lane + lanes_count)).to_a.shuffle
```

## 修改后的逻辑

现在统一从1号赛道开始连续分配：

```ruby
# 新代码
heat_athletes.each_with_index do |athlete, index|
  lane = heat.lanes.create!(lane_number: index + 1)
  lane.lane_athletes.create!(athlete: athlete)
end
```

## 分配规则

### 示例1：6个运动员（满员）
- 赛道分配：1, 2, 3, 4, 5, 6

### 示例2：3个运动员（不满员）
- 赛道分配：1, 2, 3
- 空闲赛道：4, 5, 6

### 示例3：1个运动员（独自一组）
- 赛道分配：1
- 空闲赛道：2, 3, 4, 5, 6

## 实际测试结果

```
开始生成径赛分组...
跑道数量: 6
==================================================

项目: 400米 (男)
报名人数: 8
  第1组: 6人 -> 赛道 1, 2, 3, 4, 5, 6
  第2组: 2人 -> 赛道 1, 2

项目: 100米 (男)
报名人数: 13
  第1组: 6人 -> 赛道 1, 2, 3, 4, 5, 6
  第2组: 6人 -> 赛道 1, 2, 3, 4, 5, 6
  第3组: 1人 -> 赛道 1

项目: 1000米 (男)
报名人数: 8
  第1组: 6人 -> 赛道 1, 2, 3, 4, 5, 6
  第2组: 2人 -> 赛道 1, 2
```

## 优势

1. **规范统一**：所有分组都从1号赛道开始
2. **便于管理**：裁判员和计时员容易识别
3. **符合习惯**：符合田径比赛的通用规则
4. **易于理解**：运动员和观众容易理解位置

## 相关文件

- `app/controllers/heats_controller.rb` - 径赛分组生成逻辑
- `app/models/lane.rb` - 赛道模型

## 注意事项

- 运动员顺序仍然是随机打乱的（`shuffled_athletes = athletes.shuffle`）
- 只是赛道号固定从1开始，不影响运动员的随机分配
- 接力项目保持原有逻辑（按班级分组）
